bank leumi:

installed plugins in jenkins:
docker for agent
docker pipeline for building and pushing the image
aws creedentials

kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.3.0/deploy/static/provider/cloud/deploy.yaml

kubectl create namespace argocd
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml


create this file -> then:

{
    "Changes": [
        {
            "Action": "UPSERT",
            "ResourceRecordSet": {
                "Name": "argocd.stockpnl.com.",
                "Type": "A",
                "AliasTarget": {
                    "HostedZoneId": "Z23TAZ6LKFMNIO",
                    "DNSName": "abded562412844106a5b30d63a5ee994-873960507.eu-north-1.elb.amazonaws.com.",
                    "EvaluateTargetHealth": false
                }
            }
        }
    ]
}

this will create the argocd cname

# this will apply the changes
aws route53 change-resource-record-sets --hosted-zone-id Z022564630P941WV72XMM --change-batch file://route53-records.json

#
kubectl patch deployment ingress-nginx-controller -n ingress-nginx --type='json' -p '[{"op":"add","path":"/spec/template/spec/containers/0/args/-","value":"--enable-ssl-passthrough"}]'
